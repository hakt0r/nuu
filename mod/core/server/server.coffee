console.log """\n#######################################################################################
#### NUU ### 0.4.73 ### Gordon Cooper - Astronaut - * 3/6/1927 † 10/4/2004 ############
#######################################################################################

                       ░░░░█░▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒██
                  ▒ ▒▒░▒▒██ ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒ ░     ░██ ▒▒▒▒▒▒▒▒▒▒██░
                 ▒ ▒▒  ██▒▒▒▒▒▒▒▒▒▒ ░      ▒░ ░ ░░░░ ░ ▒▒▒▒▒▒▒ ████
                ▒ ██▒▒▒▒▒▒░█░     ▒▒▒▒▒░░▒░      ░ ░░ ░░▓▓█▓▓██▓████
                ██▒▒▒▒▒░▓██        ▒▒▒░░░░░ ░▒░░░░   ░░░░ ▓▓████████░
            ░ ██▒▒▒ ▒████░░░     ▒▒▒▒▒▒▒▒░░░░░░░░░░░░░░░░▒░░█████████
            ░█▒ ▒▒▒░█████░░        ▒▒▒▒▒░▒░░░░░ ░░░░░░░▒ ▒▒▒█▓███████░
         ░▓▒▒▒▒ ░█████░░░░░      ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒█ ░▒▒ ▓▓▓▓▓▓████░
        ██▒▒▒▒░▓▓████░░░░░       ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒ ▒▒░▒▒▒▓██▓▓█████
       █▓░░▓▓▓███████░░░░      ▒ ▒▒▒▒▒█░░     ▒▒▒░  ▒▒▒░░░░░   ▓█▓██████░
      ░█ ▓▓▓▓▓▓████░░█░░░ ░     ░░     ░░░░░   ▒▒░░░ ▒▒▒░░░░▒ ▒█▓████████
    ░░█▓▒▒  ▒▓█████░█░░░░░ ░░    ░░ ▒▒░█  ░   ▒   ▒▒▒▒░      ░░ █▓█████████
     ░█ ▒▒▒  ▒██████░░░░░        ░ ▒▒▒▒▒░▒   ▒▒  ▒▒▒▒▒▒░      ░▒░██▓███████░
      ▓▒ ░▒▒▒▒▒ ███░░             ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒  ▒▒▒▒▒▒░     ░░███████░███
    ▒ █ ▒▒░▒▒▒▒▒▒██░░            ▒▒▒▒▒▒▒░▒▒▒▒▒▒▒ ▒▒▒ ▒▒▒▒▒░ ░░░░░███████ ░███▒
    ▒▒ █ ▒▒▒▒ ▒▒ ▒░█░      ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒    ▒▒       ░░▒▒░░░██░████░▒██
    ▒▒▒█▒ ▒▒ ░░ ▒▒▒░█░      ▒  ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒       ░  ▒▒░ ░░▒▒░░████░░ ░ █
    ▒▒▒ ▓  ▒ ███ ░▒▒░█░░       ▒▒▒▒▒▒▒▒▒ ▒▒▒▒▒ ▒▒  ░    ▒░ ▒░░  ░▒░███░█░ ░▒█░
    ▒▒▒▒▒▓▒ ▒▒█░█  ▒▒▒██░          ▒▒  ▒▒▒▒▒▒  ▒▒▒     ▒▒░░░░▒▒▒▒░ ░░▒███▓░░░
     ░▒▒▒▒▒█▒▒▒▒▒▒▒░  ▒▓█░░             ▒▒ ▒▒▒▒▒ ▒▒   ▒░░ ▒▒░▒▒░ ░█▒█░░░░
      ░▒▒▒░▒▒▒ █▓▓▓░█ ░ ██░           ▒   ▒ ▒  ▒ ▒▒  ░░   ▒▒▒░░ ░░▒██░▒
        ░▒▒▒▒▒▒ ▓▓▓▓▓▓░░▓██░ ░░            ▒▒      ██░ ▒▒▒▒▒▒▒▒  ██▒░
          ▒▒▒▒░▒▒ █▓█▓▓▓▓▓███▓██▓▓▓██▓▓▓▓▓▓█░ ░░░░ ▒      ░░███▒▒░░░
               ▒▒▒▒▒▒▒░░▒▒▒░▒░█▓▓█▒▒░▒▒▒▒▒▒▒▒▒▒▒ ▒▒▒▒▒░░░░░▒▒░░░▒▒
                  ░▒▒▒▒▒▒▒▒▒▒░░▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒░

#######################################################################################

    * c) 2007-2019 Sebastian Glaser <anx@ulzq.de>
    * c) 2007-2018 flyc0r

    The nuu project intends to use all the asset files according to
    their respective licenses.

    nuu currently uses the graphics and sound assets of the excellent
    naev project, which in turn are partly attributable to the
    Vega Strike project.

    All assets are downloaded from their source repo to the contrib
    folder during the build process and LICENSE information is copied
    to the build directory as well as being made available in the
    client's about screen and the server splash.

    for more information see:
      build/ARTWORK_LICENSE.txt
      build/SOUND_LICENSE.txt

#######################################################################################"""

# ██       ██████   ██████ ██   ██ ███████ ██ ██      ███████
# ██      ██    ██ ██      ██  ██  ██      ██ ██      ██
# ██      ██    ██ ██      █████   █████   ██ ██      █████
# ██      ██    ██ ██      ██  ██  ██      ██ ██      ██
# ███████  ██████   ██████ ██   ██ ██      ██ ███████ ███████

fs = require 'fs'; require 'colors'; path = require 'path'
lockPath = '/tmp/nuu.lock.' + ( process.env.CHGID || process.getuid() )
if fs.existsSync lockPath
  pid = parseInt fs.readFileSync lockPath, 'utf8'
  cp = require 'child_process'
  try
    cp.execSync "while fuser -k #{lockPath}; do :; done >/dev/null 2>&1"
    console.log 'lock', 'killed'.green, pid.toString().red
  catch
    console.log ':nuu', 'stale lockfile', pid
fs.writeFileSync lockPath, process.pid
fs.open lockPath, 0, ->

process.chdir BASEDIR = path.dirname __dirname

# ███████ ██   ██ ██████   ██████  ████████  ██████ ██    ██ ████████ ███████
# ██      ██   ██ ██   ██ ██    ██    ██    ██      ██    ██    ██    ██
# ███████ ███████ ██████  ██    ██    ██    ██      ██    ██    ██    ███████
#      ██ ██   ██ ██   ██ ██    ██    ██    ██      ██    ██    ██         ██
# ███████ ██   ██ ██   ██  ██████     ██     ██████  ██████     ██    ███████

fs.readJSONSync = (path)-> JSON.parse fs.readFileSync path
fs.writeJSONSync = (path,data)-> fs.writeFileSync path, JSON.stringify data

# ███████ ███    ██ ██    ██ ██ ██████   ██████  ███    ██ ███    ███ ███████ ███    ██ ████████
# ██      ████   ██ ██    ██ ██ ██   ██ ██    ██ ████   ██ ████  ████ ██      ████   ██    ██
# █████   ██ ██  ██ ██    ██ ██ ██████  ██    ██ ██ ██  ██ ██ ████ ██ █████   ██ ██  ██    ██
# ██      ██  ██ ██  ██  ██  ██ ██   ██ ██    ██ ██  ██ ██ ██  ██  ██ ██      ██  ██ ██    ██
# ███████ ██   ████   ████   ██ ██   ██  ██████  ██   ████ ██      ██ ███████ ██   ████    ██

global.$static   = (name,value) -> global[name] = value
$static.list     = global
global.$library  = (args...) -> for a in args
  if Array.isArray a then global[a[0]] = require a[1] else global[a] = require a
global.$public   = (args...) -> global[a.name] = a for a in args
global.$cue      = (f) -> setImmediate f

$static 'debug',    process.env.DEBUG
$static 'isClient', no
$static 'isServer', yes

$static 'NET', {}
$static 'NUU', {}
$static.list.TTL = new Set

# ██       ██████   █████  ██████      ███████  ██████  ██    ██ ██████   ██████ ███████ ███████
# ██      ██    ██ ██   ██ ██   ██     ██      ██    ██ ██    ██ ██   ██ ██      ██      ██
# ██      ██    ██ ███████ ██   ██     ███████ ██    ██ ██    ██ ██████  ██      █████   ███████
# ██      ██    ██ ██   ██ ██   ██          ██ ██    ██ ██    ██ ██   ██ ██      ██           ██
# ███████  ██████  ██   ██ ██████      ███████  ██████   ██████  ██   ██  ██████ ███████ ███████

NUU.deps = deps = fs.readJSONSync './build/build.json'

for lib in deps.server.require
  if Array.isArray lib
    if lib.length is 3
      $static lib[0], require(lib[1])[lib[2]]
    else $static lib[0], require(lib[1])
  else $static lib, require lib
